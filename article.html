<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مقهى الفوركس - المقال</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Article Page Specific Styles */
        .article-page {
            min-height: 100vh;
            padding-top: 120px;
        }
        
        .article-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 40px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* Use same sidebar styles as main page */
        .article-page .sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }
        
        .article-container {
            max-width: 900px;
            padding: 0;
        }
        
        @media (max-width: 1024px) {
            .article-layout {
                grid-template-columns: 1fr;
            }
            
            .article-page .sidebar {
                position: relative;
                top: 0;
                order: 2;
                margin-top: 40px;
            }
        }
        
        .article-header {
            margin-bottom: 30px;
            padding-top: 20px;
        }
        
        .article-breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #888;
        }
        
        .article-breadcrumb a {
            color: #d97706;
            text-decoration: none;
        }
        
        .article-breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .article-breadcrumb i {
            font-size: 10px;
        }
        
        .article-category {
            display: inline-block;
            background: linear-gradient(135deg, #d97706, #f59e0b);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .article-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 20px;
            line-height: 1.4;
        }
        
        .article-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: #888;
            font-size: 14px;
        }
        
        .article-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .article-meta-item i {
            color: #d97706;
        }
        
        .article-featured-image {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
            border-radius: 16px;
            margin-bottom: 30px;
        }
        
        .article-content {
            font-size: 18px;
            line-height: 1.9;
            color: #ccc;
        }
        
        .article-content p {
            margin-bottom: 20px;
        }
        
        .article-content h2 {
            font-size: 1.8rem;
            color: #fff;
            margin: 40px 0 20px;
        }
        
        .article-content h3 {
            font-size: 1.4rem;
            color: #fff;
            margin: 30px 0 15px;
        }
        
        .article-content ul, .article-content ol {
            margin: 20px 0;
            padding-right: 30px;
        }
        
        .article-content li {
            margin-bottom: 10px;
        }
        
        .article-content blockquote {
            border-right: 4px solid #d97706;
            padding: 20px 30px;
            margin: 30px 0;
            background: rgba(217, 119, 6, 0.1);
            border-radius: 0 12px 12px 0;
            font-style: italic;
        }
        
        .article-content img {
            max-width: 100%;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .article-content a {
            color: #d97706;
            text-decoration: none;
        }
        
        .article-content a:hover {
            text-decoration: underline;
        }
        
        .article-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .article-tag {
            background: rgba(217, 119, 6, 0.15);
            color: #d97706;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .article-tag:hover {
            background: #d97706;
            color: white;
        }
        
        .article-share {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
        }
        
        .article-share span {
            color: #888;
            font-size: 14px;
        }
        
        .share-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .share-btn.twitter { background: #1da1f2; color: white; }
        .share-btn.facebook { background: #4267b2; color: white; }
        .share-btn.whatsapp { background: #25d366; color: white; }
        .share-btn.telegram { background: #0088cc; color: white; }
        .share-btn.copy { background: rgba(255,255,255,0.1); color: #888; }
        
        .share-btn:hover {
            transform: scale(1.1);
        }
        
        .article-navigation {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-article {
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .nav-article:hover {
            background: rgba(217, 119, 6, 0.1);
        }
        
        .nav-article-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }
        
        .nav-article-title {
            color: #fff;
            font-weight: 500;
        }
        
        .nav-article.next {
            text-align: left;
        }
        
        .related-articles {
            margin-top: 60px;
        }
        
        .related-articles h3 {
            font-size: 1.5rem;
            color: #fff;
            margin-bottom: 25px;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .related-card {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            overflow: hidden;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .related-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.05);
        }
        
        .related-card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
        }
        
        .related-card-content {
            padding: 15px;
        }
        
        .related-card-title {
            color: #fff;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .related-card-date {
            font-size: 12px;
            color: #888;
        }
        
        .article-loading {
            text-align: center;
            padding: 100px 20px;
        }
        
        .article-loading i {
            font-size: 48px;
            color: #d97706;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .article-error {
            text-align: center;
            padding: 100px 20px;
        }
        
        .article-error i {
            font-size: 64px;
            color: #ef4444;
            margin-bottom: 20px;
        }
        
        .article-error h2 {
            color: #fff;
            margin-bottom: 15px;
        }
        
        .article-error p {
            color: #888;
            margin-bottom: 30px;
        }
        
        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #d97706, #f59e0b);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-back:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(217, 119, 6, 0.3);
        }
        
        @media (max-width: 768px) {
            .article-title {
                font-size: 1.8rem;
            }
            
            .article-content {
                font-size: 16px;
            }
            
            .article-navigation {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">
                <div class="logo-text">
                    <span class="logo-candles">
                        <svg viewBox="0 0 40 30" width="40" height="30">
                            <rect x="4" y="8" width="4" height="14" fill="#10b981" rx="1"/>
                            <line x1="6" y1="4" x2="6" y2="8" stroke="#10b981" stroke-width="1.5"/>
                            <line x1="6" y1="22" x2="6" y2="26" stroke="#10b981" stroke-width="1.5"/>
                            <rect x="12" y="12" width="4" height="10" fill="#ef4444" rx="1"/>
                            <line x1="14" y1="6" x2="14" y2="12" stroke="#ef4444" stroke-width="1.5"/>
                            <line x1="14" y1="22" x2="14" y2="26" stroke="#ef4444" stroke-width="1.5"/>
                            <rect x="20" y="6" width="4" height="16" fill="#10b981" rx="1"/>
                            <line x1="22" y1="2" x2="22" y2="6" stroke="#10b981" stroke-width="1.5"/>
                            <line x1="22" y1="22" x2="22" y2="28" stroke="#10b981" stroke-width="1.5"/>
                            <rect x="28" y="10" width="4" height="12" fill="#ef4444" rx="1"/>
                            <line x1="30" y1="5" x2="30" y2="10" stroke="#ef4444" stroke-width="1.5"/>
                            <line x1="30" y1="22" x2="30" y2="26" stroke="#ef4444" stroke-width="1.5"/>
                        </svg>
                    </span>
                    <span class="logo-words">
                        <span class="logo-ar">فوركس كافيه</span>
                        <span class="logo-en">Forex.Cafe</span>
                    </span>
                </div>
            </a>
            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="index.html"><i class="fas fa-home"></i> الرئيسية</a></li>
                    <li><a href="index.html#what-is-forex"><i class="fas fa-question-circle"></i> ما هو الفوركس</a></li>
                    <li><a href="index.html#strategies"><i class="fas fa-chess"></i> الاستراتيجيات</a></li>
                    <li><a href="index.html#analysis"><i class="fas fa-chart-bar"></i> التحليلات</a></li>
                    <li><a href="index.html#news"><i class="fas fa-newspaper"></i> الأخبار</a></li>
                    <li><a href="index.html#education"><i class="fas fa-graduation-cap"></i> التعليم</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Article Page -->
    <main class="article-page">
        <div class="article-layout">
            <!-- Sidebar (same structure as main page) -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-th-large"></i>
                        الأقسام الرئيسية
                    </h3>
                    <ul class="sidebar-menu" id="sidebarSections">
                        <!-- Sections will be loaded dynamically -->
                        <li class="menu-item">
                            <a href="index.html" class="menu-link">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>جاري التحميل...</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-fire"></i>
                        الأكثر قراءة
                    </h3>
                    <ul class="popular-posts" id="popularPosts">
                        <!-- Popular posts will be loaded dynamically -->
                    </ul>
                </div>
            </aside>
            
            <!-- Main Article Content -->
            <div class="article-container">
            <!-- Loading State -->
            <div id="articleLoading" class="article-loading">
                <i class="fas fa-spinner"></i>
                <p style="margin-top: 20px; color: #888;">جاري تحميل المقال...</p>
            </div>
            
            <!-- Error State -->
            <div id="articleError" class="article-error" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <h2>لم يتم العثور على المقال</h2>
                <p>المقال الذي تبحث عنه غير موجود أو تم حذفه</p>
                <a href="index.html" class="btn-back">
                    <i class="fas fa-arrow-right"></i>
                    العودة للصفحة الرئيسية
                </a>
            </div>
            
            <!-- Article Content -->
            <article id="articleContent" style="display: none;">
                <header class="article-header">
                    <nav class="article-breadcrumb">
                        <a href="index.html">الرئيسية</a>
                        <i class="fas fa-chevron-left"></i>
                        <a href="index.html#articles" id="articleSection">المقالات</a>
                        <i class="fas fa-chevron-left"></i>
                        <span id="articleTitleBreadcrumb">عنوان المقال</span>
                    </nav>
                    
                    <span class="article-category" id="articleCategory">تحليل</span>
                    
                    <h1 class="article-title" id="articleTitle">عنوان المقال</h1>
                    
                    <div class="article-meta">
                        <div class="article-meta-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span id="articleDate">14 ديسمبر 2025</span>
                        </div>
                        <div class="article-meta-item">
                            <i class="fas fa-eye"></i>
                            <span id="articleViews">0</span> مشاهدة
                        </div>
                        <div class="article-meta-item">
                            <i class="fas fa-clock"></i>
                            <span id="articleReadTime">3 دقائق</span> قراءة
                        </div>
                    </div>
                </header>
                
                <img id="articleImage" class="article-featured-image" src="" alt="" style="display: none;">
                
                <div class="article-content" id="articleBody">
                    <!-- Article content will be loaded here -->
                </div>
                
                <div class="article-tags" id="articleTags">
                    <!-- Tags will be loaded here -->
                </div>
                
                <div class="article-share">
                    <span><i class="fas fa-share-alt"></i> مشاركة:</span>
                    <button class="share-btn twitter" onclick="shareArticle('twitter')" title="تويتر">
                        <i class="fab fa-twitter"></i>
                    </button>
                    <button class="share-btn facebook" onclick="shareArticle('facebook')" title="فيسبوك">
                        <i class="fab fa-facebook-f"></i>
                    </button>
                    <button class="share-btn whatsapp" onclick="shareArticle('whatsapp')" title="واتساب">
                        <i class="fab fa-whatsapp"></i>
                    </button>
                    <button class="share-btn telegram" onclick="shareArticle('telegram')" title="تيليجرام">
                        <i class="fab fa-telegram-plane"></i>
                    </button>
                    <button class="share-btn copy" onclick="copyArticleLink()" title="نسخ الرابط">
                        <i class="fas fa-link"></i>
                    </button>
                </div>
                
                <!-- Related Articles -->
                <div class="related-articles" id="relatedArticles" style="display: none;">
                    <h3><i class="fas fa-newspaper text-gold"></i> مقالات ذات صلة</h3>
                    <div class="related-grid" id="relatedGrid">
                        <!-- Related articles will be loaded here -->
                    </div>
                </div>
            </article>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>مقهى الفوركس</h4>
                    <p>منصة عربية متخصصة في تعليم التداول وتحليل الأسواق المالية</p>
                </div>
                <div class="footer-section">
                    <h4>روابط سريعة</h4>
                    <ul>
                        <li><a href="index.html">الرئيسية</a></li>
                        <li><a href="index.html#articles">المقالات</a></li>
                        <li><a href="index.html#education">التعليم</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>تواصل معنا</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-telegram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2025 مقهى الفوركس - جميع الحقوق محفوظة</p>
            </div>
        </div>
    </footer>

    <script>
        // API Base URL
        const API_BASE = '/api';
        
        // Sections and Subsections cache
        let sectionsCache = {};
        let subsectionsCache = {};
        
        // Current article data
        let currentArticle = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            await loadCategoriesData();
            loadArticle();
        });
        
        // Load sections and subsections for category display
        async function loadCategoriesData() {
            try {
                // Load sections
                const sectionsRes = await fetch(`${API_BASE}/sections`);
                const sectionsData = await sectionsRes.json();
                if (sectionsData.success) {
                    sectionsData.data.forEach(s => {
                        sectionsCache[s.id] = s;
                    });
                }
                
                // Load subsections
                const subsectionsRes = await fetch(`${API_BASE}/subsections`);
                const subsectionsData = await subsectionsRes.json();
                if (subsectionsData.success) {
                    subsectionsData.data.forEach(s => {
                        subsectionsCache[s.id] = s;
                    });
                }
                
                // Render sidebar sections
                renderSidebarSections();
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }
        
        // Render sections in sidebar (same style as main page)
        function renderSidebarSections() {
            const sidebar = document.getElementById('sidebarSections');
            if (!sidebar) return;
            
            const sections = Object.values(sectionsCache);
            
            // Icon mapping for sections
            const sectionIcons = {
                'التحليلات': 'fa-chart-line',
                'الاستراتيجيات': 'fa-chess',
                'الأخبار': 'fa-newspaper',
                'التعليم': 'fa-graduation-cap',
                'إدارة المخاطر': 'fa-shield-alt',
                'منصات التداول': 'fa-laptop',
                'العملات الرقمية': 'fa-bitcoin',
                'default': 'fa-folder'
            };
            
            sidebar.innerHTML = sections.map(section => {
                const icon = sectionIcons[section.name] || sectionIcons['default'];
                const subsections = Object.values(subsectionsCache).filter(s => s.sectionId === section.id);
                
                return `
                    <li class="menu-item has-submenu" data-section-id="${section.id}">
                        <a href="index.html?section=${section.id}" class="menu-link">
                            <i class="fas ${icon}"></i>
                            <span>${section.name}</span>
                            ${subsections.length > 0 ? '<i class="fas fa-chevron-down arrow"></i>' : ''}
                        </a>
                        ${subsections.length > 0 ? `
                            <ul class="submenu">
                                ${subsections.map(sub => `
                                    <li>
                                        <a href="index.html?subsection=${sub.id}" data-subsection-id="${sub.id}">${sub.name}</a>
                                    </li>
                                `).join('')}
                            </ul>
                        ` : ''}
                    </li>
                `;
            }).join('');
            
            // Load popular posts
            loadPopularPosts();
        }
        
        // Load popular posts for sidebar
        async function loadPopularPosts() {
            const container = document.getElementById('popularPosts');
            if (!container) return;
            
            try {
                const response = await fetch(`${API_BASE}/articles?status=published&limit=4`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    container.innerHTML = result.data.map((article, index) => `
                        <li>
                            <a href="article.html?id=${article.id}">
                                <span class="post-number">${index + 1}</span>
                                <span class="post-title">${article.title}</span>
                            </a>
                        </li>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading popular posts:', error);
            }
        }
        
        // Highlight current section in sidebar
        function highlightCurrentSection(article) {
            if (!article) return;
            
            // Remove all active classes
            document.querySelectorAll('.sidebar-menu .menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.sidebar-menu .submenu a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Highlight current section
            if (article.sectionId) {
                const menuItem = document.querySelector(`.menu-item[data-section-id="${article.sectionId}"]`);
                if (menuItem) {
                    menuItem.classList.add('active');
                }
            }
            
            // Highlight current subsection
            if (article.subsectionId) {
                const submenuLink = document.querySelector(`.submenu a[data-subsection-id="${article.subsectionId}"]`);
                if (submenuLink) {
                    submenuLink.classList.add('active');
                    submenuLink.style.color = 'var(--primary)';
                    submenuLink.style.background = 'var(--bg-glass)';
                }
            }
        }
        
        // Get section name by ID
        function getSectionName(id) {
            return sectionsCache[id]?.name || 'عام';
        }
        
        // Get subsection name by ID
        function getSubsectionName(id) {
            return subsectionsCache[id]?.name || '';
        }
        
        // Load article from API
        async function loadArticle() {
            const urlParams = new URLSearchParams(window.location.search);
            const articleId = urlParams.get('id');
            
            if (!articleId) {
                showError();
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/articles/${articleId}`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    currentArticle = result.data;
                    displayArticle(result.data);
                    loadRelatedArticles(result.data);
                    // Increment view count
                    incrementViews(articleId);
                } else {
                    showError();
                }
            } catch (error) {
                console.error('Error loading article:', error);
                showError();
            }
        }
        
        // Display article content
        function displayArticle(article) {
            // Hide loading
            document.getElementById('articleLoading').style.display = 'none';
            
            // Show content
            document.getElementById('articleContent').style.display = 'block';
            
            // Highlight current section in sidebar
            highlightCurrentSection(article);
            
            // Set page title
            document.title = `${article.title} - مقهى الفوركس`;
            
            // Set article title
            document.getElementById('articleTitle').textContent = article.title;
            document.getElementById('articleTitleBreadcrumb').textContent = article.title;
            
            // Set category
            const categoryName = getCategoryDisplay(article);
            document.getElementById('articleCategory').textContent = categoryName;
            document.getElementById('articleSection').textContent = getSectionName(article.sectionId);
            
            // Set meta info
            document.getElementById('articleDate').textContent = formatDate(article.publishedAt || article.createdAt);
            document.getElementById('articleViews').textContent = article.views || 0;
            document.getElementById('articleReadTime').textContent = calculateReadTime(article.content);
            
            // Set featured image
            if (article.thumbnail) {
                const img = document.getElementById('articleImage');
                img.src = article.thumbnail;
                img.alt = article.title;
                img.style.display = 'block';
            }
            
            // Set content
            document.getElementById('articleBody').innerHTML = formatContent(article.content);
            
            // Set tags
            if (article.tags) {
                const tagsArray = typeof article.tags === 'string' ? article.tags.split(',') : article.tags;
                if (tagsArray && tagsArray.length > 0) {
                    document.getElementById('articleTags').innerHTML = tagsArray.map(tag => 
                        `<a href="index.html?tag=${encodeURIComponent(tag.trim())}" class="article-tag">#${tag.trim()}</a>`
                    ).join('');
                }
            }
        }
        
        // Get category display text
        function getCategoryDisplay(article) {
            const section = getSectionName(article.sectionId);
            const subsection = getSubsectionName(article.subsectionId);
            if (subsection) {
                return `${section} / ${subsection}`;
            }
            return section;
        }
        
        // Format date to Arabic
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('ar-SA', options);
        }
        
        // Calculate read time
        function calculateReadTime(content) {
            if (!content) return '1';
            const words = content.split(/\s+/).length;
            const minutes = Math.ceil(words / 200);
            return minutes.toString();
        }
        
        // Format content (convert newlines to paragraphs, handle HTML)
        function formatContent(content) {
            if (!content) return '<p>لا يوجد محتوى</p>';
            
            // Check if content is already HTML
            if (content.includes('<p>') || content.includes('<div>') || content.includes('<h')) {
                return content;
            }
            
            // Convert plain text to paragraphs
            return content.split('\n\n').map(para => 
                para.trim() ? `<p>${para.replace(/\n/g, '<br>')}</p>` : ''
            ).join('');
        }
        
        // Load related articles
        async function loadRelatedArticles(article) {
            try {
                const response = await fetch(`${API_BASE}/articles?status=published&limit=3`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Filter out current article
                    const related = result.data.filter(a => a.id !== article.id).slice(0, 3);
                    
                    if (related.length > 0) {
                        const grid = document.getElementById('relatedGrid');
                        grid.innerHTML = related.map(a => `
                            <a href="article.html?id=${a.id}" class="related-card">
                                <img src="${a.thumbnail || 'assets/placeholder.jpg'}" alt="${a.title}">
                                <div class="related-card-content">
                                    <h4 class="related-card-title">${a.title}</h4>
                                    <span class="related-card-date">${formatDate(a.publishedAt || a.createdAt)}</span>
                                </div>
                            </a>
                        `).join('');
                        
                        document.getElementById('relatedArticles').style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Error loading related articles:', error);
            }
        }
        
        // Increment view count
        async function incrementViews(articleId) {
            try {
                await fetch(`${API_BASE}/articles/${articleId}/view`, { method: 'POST' });
            } catch (error) {
                // Silently fail - not critical
            }
        }
        
        // Show error state
        function showError() {
            document.getElementById('articleLoading').style.display = 'none';
            document.getElementById('articleError').style.display = 'block';
        }
        
        // Share functions
        function shareArticle(platform) {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent(currentArticle?.title || document.title);
            
            const urls = {
                twitter: `https://twitter.com/intent/tweet?url=${url}&text=${title}`,
                facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`,
                whatsapp: `https://wa.me/?text=${title}%20${url}`,
                telegram: `https://t.me/share/url?url=${url}&text=${title}`
            };
            
            if (urls[platform]) {
                window.open(urls[platform], '_blank', 'width=600,height=400');
            }
        }
        
        function copyArticleLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('تم نسخ الرابط!');
            });
        }
    </script>
</body>
</html>
